<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>钟文钦的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="钟文钦的博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="钟文钦的博客">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="钟文钦的博客">
  
    <link rel="alternate" href="/atom.xml" title="钟文钦的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">钟文钦的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-123" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/19/123/" class="article-date">
  <time datetime="2019-06-19T09:18:14.000Z" itemprop="datePublished">2019-06-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/19/123/">123</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>就是想测试一下<br>测试1222</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/06/19/123/" data-id="cjx33318z00001ld2vj6yf9o8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/19/hello-world/" class="article-date">
  <time datetime="2019-06-19T09:15:27.237Z" itemprop="datePublished">2019-06-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/19/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/06/19/hello-world/" data-id="cjx33319900041ld2tpzgnh57" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-TypeScript渐进(1)-安装及调试工具" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/19/TypeScript渐进(1)-安装及调试工具/" class="article-date">
  <time datetime="2019-06-19T07:05:53.000Z" itemprop="datePublished">2019-06-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/19/TypeScript渐进(1)-安装及调试工具/">TypeScript渐进(1)-安装及调试工具</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="TypeScript安装及工具调试"><a href="#TypeScript安装及工具调试" class="headerlink" title="TypeScript安装及工具调试"></a>TypeScript安装及工具调试</h2><p>我是采用vscode作为开发编辑器，往后的TS调试也是基于此编辑器的。</p>
<p>TS的全局安装及调试工具安装命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install typescript -g </span><br><span class="line">npm install ts-node -g</span><br></pre></td></tr></table></figure>

<p>注意记下ts-node安装后的文件路径，后面需要用到。</p>
<p><img src="https://i.loli.net/2019/06/19/5d09e5c45e02535213.jpg" alt="复制文件路径"></p>
<h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><p>1.在vscode上创建tsDemo文件夹</p>
<p>2.在tsDemo文件夹中创建hello.ts文件</p>
<p>3.在文件里写一句话console.log(‘hello ts!’)然后保存</p>
<p>4.Windows 用户注意了，这里需要单独运行一些命令（Linux 用户和 macOS 用户不用执行）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br><span class="line">npm i -D ts-node typescript</span><br></pre></td></tr></table></figure>

<p>5.创建.vscode文件夹，并在文件夹里面创建launch.json文件，里面的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">     &quot;configurations&quot;: [</span><br><span class="line">         &#123;</span><br><span class="line">         &quot;name&quot;: &quot;ts-node&quot;,</span><br><span class="line">         &quot;type&quot;: &quot;node&quot;,</span><br><span class="line">         &quot;request&quot;: &quot;launch&quot;,</span><br><span class="line">         &quot;program&quot;: &quot;注意看这里，要写成ts-node对应的可执行文件，Windows 用户注意了，你应该写成 $&#123;workspaceRoot&#125;/node_modules/ts-node/dist/bin.js&quot;,</span><br><span class="line">         &quot;args&quot;: [&quot;$&#123;relativeFile&#125;&quot;],</span><br><span class="line">         &quot;cwd&quot;: &quot;$&#123;workspaceRoot&#125;&quot;,</span><br><span class="line">         &quot;protocol&quot;: &quot;inspector&quot;</span><br><span class="line">         &#125;</span><br><span class="line">     ]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>6.打开tsDemo/hello.ts,找到调试选项，选择ts-node,然后点击调试即可看到输出结果</p>
<p><img src="https://i.loli.net/2019/06/19/5d09ea493b23483988.jpg" alt="调试选项"></p>
<p><img src="https://i.loli.net/2019/06/19/5d09eaddcd3ef55500.jpg" alt="输出结果"></p>
<p>参考文章: <a href="https://segmentfault.com/a/1190000011935122" target="_blank" rel="noopener">https://segmentfault.com/a/1190000011935122</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/06/19/TypeScript渐进(1)-安装及调试工具/" data-id="cjx33319500021ld2873cya86" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TypeScript/">TypeScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-面试分享一" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/07/面试分享一/" class="article-date">
  <time datetime="2018-06-06T21:51:22.000Z" itemprop="datePublished">2018-06-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/07/面试分享一/">面试分享一</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>觉得前端基础知识已经巩固的差不多，最近已经在准备使用框架的项目了。忙里偷闲去了几个公司面试，验证下阶段性的学习成果，现在来总结分享下~</p>
<h2 id="公司一"><a href="#公司一" class="headerlink" title="公司一"></a>公司一</h2><p>这个公司主要做体育方面的，有自营的APP，前端工作主要是把活动页面对接到APP上，后续计划完善公众号的内容页以及小程序的开发，前端技术框架主要用到的是vue。</p>
<p>因为提前了解过公司的技术架构，所以面试前也复习了下vue的知识，太久没用都忘得才差不多拉~现在看vue跟以前看vue差别还真是大。。。</p>
<p>没有笔试，所有的题现场出。</p>
<p>开始进入正题。</p>
<h2 id="一面"><a href="#一面" class="headerlink" title="一面"></a>一面</h2><blockquote>
<p>以前在公司使用过什么框架？</p>
</blockquote>
<p>答：react、vue、react-native都使用过，虽然能完成项目，但使用过程中比较迷惑，感觉只是单纯的用框架API而已，对于深层次的原理不能理解，因为缺乏前端的整体认知，而使用框架对前端基础知识水平要求比较高；</p>
<p>虽然也对框架涉及到的知识有去学习，像es6、webpack、MV*、模块化等等，但因为是零基础转行的，所以理解起来也是不成体系的，归根到底也就是js基础不扎实；</p>
<p>所以辞职后，为了能深入的理解框架，就大量的补充了前端方面的基础知识，主要是js方面的，还有http、命令行、node、MV*思想、模块化、webpack等等。</p>
<blockquote>
<p>回复：能找到自身的不足去弥补，很不错。</p>
</blockquote>
<blockquote>
<p>你简历上写做过移动端适配，那你是怎么做的？</p>
</blockquote>
<p>答：主要是通过动态rem + 媒体查询 + SASS实现的。</p>
<blockquote>
<p>动态rem是什么？</p>
</blockquote>
<p>答：首先rem可以根据根元素的font-size来换算的，根元素如果设置font-size：20px的话，那么1rem就是20px的大小。我一般先把根元素设成20px，然后根据页面宽度，用js来按比例计算根元素大小，这样页面上用到rem单位的元素大小都会相应的改变，移动端适配方面我在博客有记录的。</p>
<blockquote>
<p>position的几种定位有什么区别？</p>
</blockquote>
<p>答：fixed固定定位，是相对视口定位的；absolute绝对定位，是相对最近的祖先带有position样式的元素定位的，如果没有position样式，则相对于body；relative相对定位嘛。。。好像是相对与自身原来的位置。</p>
<blockquote>
<p>回复：嗯，relative相对定位会在原来的位置仍占用位置，不会脱离文档（还画了个图让我好理解。。。学习到了。。。）。</p>
</blockquote>
<p>ps：其实我回答的有错，回来查了MDN的文档，absolute绝对定位是相对于最近的非 static 祖先元素定位，static就是position的默认值。还有一个自己没有用到的sticky粘性定位，是相对定位和绝对定位的混合，通过是否超过阀值来确定是哪种定位，可用来做粘性导航的，MDN上有例子，有兴趣的可以自行尝试一下。</p>
<blockquote>
<p>你用过flex是吧，那解释下flex是什么？</p>
</blockquote>
<p>答：flex是弹性盒子，可以根据页面大小自由伸缩，在移动端适配上很好用。</p>
<blockquote>
<p>PC端不能用了？</p>
</blockquote>
<p>答：能用的能用的。。。</p>
<blockquote>
<p>那有什么属性，具体怎么用的？</p>
</blockquote>
<p>答：默认flex-direction是row横向布局的，如果为row，那么justify-content表示横向布局的排布，space-between是两端对齐，space-around是，额。。。元素间距一样的那种对齐方式（不知道怎么描述这种对齐方式，其实是每个项目两侧的间隔相等，所以，项目之间的间隔比项目与边框的间隔大一倍 by阮一峰）；还有align-items，竖直方向的排布，一般用center来做居中的。</p>
<p>ps：虽然没有说的完全，但使用还是没问题的，因为现在基本上都用flex啦，附上阮一峰的flex教程 <a href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html?^%$" target="_blank" rel="noopener">flex教程</a></p>
<blockquote>
<p>给我画了个图，就是经典双飞翼布局，两边固定宽度，中间自适应那种，问我怎么实现。</p>
</blockquote>
<p>答：用flex很好解决，两边固定宽度，中间用flex：1自适应。</p>
<blockquote>
<p>还有其他方式吗？</p>
</blockquote>
<p>答：（想了一会），两边固定，中间用calc属性计算，父级100%的宽度减去两边的宽度。</p>
<p>ps：面试官挺满意的，可能没想到用计算属性来做。其实还有一种用margin的古老方法，比较繁琐，有兴趣自行搜索双飞翼布局。</p>
<blockquote>
<p>手写了题，关于this的，代码大概如下。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>) <span class="comment">//?</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    fn1()</span><br><span class="line">&#125;</span><br><span class="line">fn2()</span><br></pre></td></tr></table></figure>

<p>答：this为window对象，然后说了下确定this的几种方式，还有严格模式下不会自动指向window对象，会是undefined，最后说博客有总结，有兴趣可以去看一下。</p>
<blockquote>
<p>闭包了解吗？</p>
</blockquote>
<p>答：说这个博客上有总结过的。闭包就是作用域的副产物，算是一道沟通内外函数的桥梁吧，因为作用域规则是内部向外部查找变量，而外部函数是得不到内部函数变量的，然后使用闭包就能间接的拿到内部函数的变量。</p>
<blockquote>
<p>应用在哪里呢？</p>
</blockquote>
<p>答：额。。可以隐藏变量，封装对象的私有属性和方法，模块化也有用到。。。</p>
<blockquote>
<p>模块化嘛~嗯嗯。</p>
</blockquote>
<blockquote>
<p>然后又手写了一道题</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)&#123;</span><br><span class="line">    event[i].onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i) <span class="comment">//?</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>答：这是作用域方面的问题，在博客也有做总结的。i是6，每个所点击的元素都是6，可以通过创造一个函数作用域来解决，或者把var改成let，限定一下变量i的作用域范围。</p>
<blockquote>
<p>继续手写题目</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">3</span>)</span><br><span class="line"><span class="comment">//结果是怎样？</span></span><br></pre></td></tr></table></figure>

<p>答：1 3 2。因为setTimeout是异步的，所以在同步代码执行完毕后才会执行。</p>
<blockquote>
<p>那么变一下</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">fn()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>不假思索的答：结果一样啊，1 3 2。</p>
<blockquote>
<p>（一脸坏笑看着我）嘿嘿，不对，在仔细看看。</p>
</blockquote>
<p>答：啊啊啊，看错了，因为之前用Promise都是管理回调用的，传入Promise对象的函数仍然是同步，结果是 1 2 3。。。</p>
<blockquote>
<p>前端做过那些优化？</p>
</blockquote>
<p>答：图片压缩是最基本的了，然后用过font-spider来切割字体（面试官貌似没听过），我解释了下 =&gt; 因为设计引入了外部字体，字体包体积有6M多，如果放到生产环境那不得慢死，所以找到了font-spider的解决方案，就是可以只保留页面上所用到的静态字体，其余没用到的都摒弃掉，最后字体包大小变成了几百K。然后还有代码压缩，减少dom操作什么的。</p>
<p>ps：前端优化其实还有很多，以前有做过的就这些，实话实说了。现在能想到的还有catch-contol添加缓存，懒加载、cdn加速、减少请求数量等等。具体得看性能瓶颈出在哪里，如果是后端响应时间长，那么前端怎么优化也没用是吧~</p>
<blockquote>
<p>es6用过吗？</p>
</blockquote>
<p>答：用过啊，let const是最基本的了，还有import、export、Promise、箭头函数、模版字符串、三个点的那个。。。（扩展运算符）、解构赋值、Set数据结构。</p>
<blockquote>
<p>那个as。。。什么的也要了解下（async：异步的 读音：鹅兴克；）</p>
</blockquote>
<p>回答：嗯嗯。有做过了解的，只是平时都用Promise来管理回调函数。</p>
<p>PS：回来总结了下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//平时用Promise管理回调函数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params">second</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(second === <span class="number">2000</span>)&#123;<span class="comment">//模拟异步成功</span></span><br><span class="line">                resolve.call(<span class="literal">undefined</span>,<span class="string">'success'</span>)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;<span class="comment">//模拟异步失败</span></span><br><span class="line">                reject.call(<span class="literal">undefined</span>,<span class="string">'error'</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,second)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">2000</span>).then(</span><br><span class="line">    (success)=&gt;&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(success)</span><br><span class="line">    &#125;,</span><br><span class="line">    (error)=&gt;&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"><span class="comment">//如果传入值为2000，则三秒后打印出'success',否则打印出'error'</span></span><br><span class="line"><span class="comment">//虽然一定程度上避免了ES5回调地狱的情况，但是代码还是不够直观的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**********async/await**********/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params">second</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(second === <span class="number">2000</span>)&#123;<span class="comment">//模拟异步成功</span></span><br><span class="line">                resolve.call(<span class="literal">undefined</span>,<span class="string">'success'</span>)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;<span class="comment">//模拟异步失败</span></span><br><span class="line">                reject.call(<span class="literal">undefined</span>,<span class="string">'error'</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,second)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params">second</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">await</span> sleep(second)</span><br><span class="line">    <span class="comment">//await等异步成功后，把结果传给result</span></span><br><span class="line">    <span class="comment">//这里有一个用法就是把异步变成了同步，即异步执行完成后才能执行后面的代码</span></span><br><span class="line">    <span class="built_in">console</span>.log(result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">x(<span class="number">2000</span>) <span class="comment">// 打印出'success'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//错误处理，用try catch</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params">second</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> result = <span class="keyword">await</span> sleep(second)</span><br><span class="line">        <span class="built_in">console</span>.log(result)  </span><br><span class="line">    &#125; <span class="keyword">catch</span> (error)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">x(<span class="number">3000</span>)<span class="comment">// 打印出'error'</span></span><br><span class="line">x(<span class="number">3000</span>).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;<span class="built_in">console</span>.log(<span class="string">'nihao'</span>)&#125;)</span><br><span class="line"><span class="comment">//三秒后，打印出'error'，接着打印出'nihao'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//这样对有更广的适用行</span></span><br><span class="line"><span class="comment">//更具有语义化，结构清晰</span></span><br><span class="line"><span class="comment">//而且async返回的是Promise对象，后面可以接上then的使用</span></span><br><span class="line"><span class="comment">//更多的用法得大家自己去深挖拉</span></span><br></pre></td></tr></table></figure>

<p><strong>感觉一面还行，还算比较满意。事后得知面试官对我的印象也不错，一面过了</strong></p>
<h2 id="二面"><a href="#二面" class="headerlink" title="二面"></a>二面</h2><p>一面是前端负责人，二面呢是技术总监，不过可能是因为做后端的，所以问的问题比较简单。</p>
<blockquote>
<p>给了我一个需求，让我去实现。需求大概是：后端给比赛的数据，你怎么把数据按时间排序之类的，分了今天、明天、5月20号、5月21号等等。</p>
</blockquote>
<center><img src="https://s1.ax2x.com/2018/06/07/RsNvG.jpg" alt="灵魂画手风格" border="0"></center>

<p>因为还没有做过这样的需求，我想了会，说这个首先得看后端传的数据是怎样的吧，如果后端json数据做好了，那前端比较省事，直接渲染数据就好了，可能需要转译下的是今天和明天这两个日期，通过日期比对就行了。然后前端作下拉刷新，跟后端商量好给数据的条数。</p>
<p>如果后端数据给了一大堆数据，让前端筛选，暂时就没有想到太好的办法，目前能想到用for循环来跟日期做比对，然后做筛选排序了。</p>
<p>PS：其实可以用算法来解决，但是到目前为止对算法也是了解过而已，知道大概的原理，具体其实还是得看后端传的数据结构是怎样的。而且前端也不适合做太复杂的运算，会影响页面的性能，一般来说后端把数据处理好后给前端会比较好。</p>
<blockquote>
<p>额。。后端应该是把数据处理好的。。。</p>
</blockquote>
<blockquote>
<p>http请求如果是同步会怎么样？</p>
</blockquote>
<p>答：那么拖慢页面加载的速度，因为后面的函数必须得等结果返回才能执行了。</p>
<blockquote>
<p>http状态码200和500代表什么？</p>
</blockquote>
<p>答：200请求成功，500服务端出错。</p>
<p><strong>问题不是太难，第一个问题二面面试官可能也没有考虑周全，不知道大家还有没有更好的答案呢~二面也顺利通过了</strong></p>
<h2 id="三面HR面"><a href="#三面HR面" class="headerlink" title="三面HR面"></a>三面HR面</h2><blockquote>
<p>为什么转行？</p>
</blockquote>
<blockquote>
<p>平时是怎么学习的？</p>
</blockquote>
<blockquote>
<p>前两位面试官给你的感觉怎么样？</p>
</blockquote>
<blockquote>
<p>上一份工作为什么离职？</p>
</blockquote>
<blockquote>
<p>薪资要求？</p>
</blockquote>
<p>这些问题见仁见智啦~</p>
<h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><p>结果挂了 T T，挂在HR那面，后面有去发邮件询问原因的也没有明说。。。</p>
<p>总的来说这次面试倾向于基础知识方面的，这方面准备的也比较充足，所以答的还行，技术问题细节可能有些出入，但知识点没有多大问题的。</p>
<p>分享给大家以作参考，如有错漏希望大家能帮我指正下~</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/07/面试分享一/" data-id="cjx33319u000v1ld2vu0nan85" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-注册登陆基本流程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/22/注册登陆基本流程/" class="article-date">
  <time datetime="2018-05-22T15:56:57.000Z" itemprop="datePublished">2018-05-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/22/注册登陆基本流程/">注册登陆基本流程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>从一开始就接触框架，虽然确实很省心省力，但是忽略了很多，很多时候无法看到根本的问题。<br>今天来探讨下注册登陆流程，用粗暴简单的写法，前后端没有加验证，主要是了解下这个流程到底是怎么走的。</p>
<h2 id="搭建基本页面"><a href="#搭建基本页面" class="headerlink" title="搭建基本页面"></a>搭建基本页面</h2><p>首先准备好注册登陆页面</p>
<center><img src="http://wx1.sinaimg.cn/mw690/0060lm7Tly1frkkqhcntjj30ea0agq2v.jpg" alt="注册页面"></center>

<center><img src="http://wx2.sinaimg.cn/mw690/0060lm7Tly1frkkqha2uxj30dl0bbt8m.jpg" alt="登陆页面"></center>

<h2 id="注册流程前端js代码"><a href="#注册流程前端js代码" class="headerlink" title="注册流程前端js代码"></a>注册流程前端js代码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引用jQuery</span></span><br><span class="line"> <span class="keyword">let</span> $form = $(<span class="string">'#signUpForm'</span>)</span><br><span class="line">        $form.on(<span class="string">'submit'</span>,(e)=&gt;&#123;</span><br><span class="line">            e.preventDefault() <span class="comment">//阻止默认事件，阻止刷新浏览器</span></span><br><span class="line">            <span class="keyword">let</span> data = &#123;&#125;</span><br><span class="line">            <span class="keyword">let</span> accountInfo = [<span class="string">'userName'</span>,<span class="string">'password'</span>,<span class="string">'password_confirmation'</span>]</span><br><span class="line">            accountInfo.forEach(<span class="function">(<span class="params">name</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">let</span> value = $form.find(<span class="string">`[name=<span class="subst">$&#123;name&#125;</span>]`</span>).val()</span><br><span class="line">                data[name] = value</span><br><span class="line">            &#125;)  <span class="comment">//获取用户填写信息</span></span><br><span class="line">            </span><br><span class="line">            $.post(<span class="string">'/sign_up'</span>,data) <span class="comment">//post请求把数据传到后端</span></span><br><span class="line">            .then(<span class="function">(<span class="params">reponse</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">let</span> userName = <span class="built_in">JSON</span>.parse(reponse)</span><br><span class="line">                <span class="built_in">console</span>.log(userName)</span><br><span class="line">                alert(<span class="string">'注册成功'</span>) <span class="comment">//如果注册成功，获取后端返回JSON数据</span></span><br><span class="line">            &#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="built_in">window</span>.location = <span class="string">"/sign_in"</span> <span class="comment">//注册成功后，帮助用户跳页面</span></span><br><span class="line">            &#125;)</span><br><span class="line">           </span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure>

<p>前端js流程比较简单~</p>
<ol>
<li>用户填写表单信息</li>
<li>前端进行信息验证（我没做~）</li>
<li>拿到用户填写表单信息</li>
<li>post请求到后端</li>
<li>请求成功且后端验证成功，则告诉用户登陆成功，并且帮助跳转页面</li>
<li>请求成功但后端验证失败，根据后端返回的信息提示用户出错的信息</li>
</ol>
<h2 id="注册流程后端代码"><a href="#注册流程后端代码" class="headerlink" title="注册流程后端代码"></a>注册流程后端代码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//node.js</span></span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (path === <span class="string">"/sign_up"</span> &amp;&amp; method == <span class="string">"POST"</span>) &#123;</span><br><span class="line"></span><br><span class="line">        readbody(request).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> hash = &#123;&#125;</span><br><span class="line">            <span class="keyword">let</span> strings = data.split(<span class="string">'&amp;'</span>)</span><br><span class="line"></span><br><span class="line">            strings.forEach(<span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> parts = element.split(<span class="string">'='</span>)</span><br><span class="line">                <span class="keyword">let</span> key = parts[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">let</span> value = parts[<span class="number">1</span>]</span><br><span class="line">                hash[key] = value</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">//以上都是切割字符串，把字符串数据转换成对象</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> &#123;</span><br><span class="line">                userName,</span><br><span class="line">                password,</span><br><span class="line">                password_confirmation</span><br><span class="line">            &#125; = hash</span><br><span class="line">         </span><br><span class="line">            <span class="keyword">let</span> users = fs.readFileSync(<span class="string">'./db/db'</span>)</span><br><span class="line">            <span class="comment">// 读取数据库</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                users = <span class="built_in">JSON</span>.parse(users) <span class="comment">// []</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (exception) &#123;</span><br><span class="line">                users = []</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//数据库异常处理</span></span><br><span class="line">            </span><br><span class="line">            users.push(&#123;</span><br><span class="line">                userName: <span class="built_in">decodeURIComponent</span>(userName),</span><br><span class="line">                password: <span class="built_in">decodeURIComponent</span>(password)</span><br><span class="line">                <span class="comment">//decodeURIComponent转译字符串</span></span><br><span class="line">                <span class="comment">//http协议中有些字符会被转译成编码</span></span><br><span class="line">                <span class="comment">//例如@，中文字符等等</span></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">let</span> usersString = <span class="built_in">JSON</span>.stringify(users)</span><br><span class="line">            <span class="keyword">let</span> hashString = <span class="built_in">JSON</span>.stringify(hash.userName)</span><br><span class="line">            fs.writeFileSync(<span class="string">'./db/db'</span>, usersString)</span><br><span class="line">            <span class="comment">//写入把对象转为string，写入数据库</span></span><br><span class="line">            <span class="comment">//注意以上都没有经过验证</span></span><br><span class="line">            <span class="comment">//例如注册用户名是否重复，密码是否一致等等</span></span><br><span class="line">            <span class="built_in">console</span>.log(usersString)</span><br><span class="line"></span><br><span class="line">            response.statusCode = <span class="number">200</span></span><br><span class="line">            response.write(<span class="built_in">JSON</span>.stringify(hashString))</span><br><span class="line">            <span class="comment">//给前端返回userName</span></span><br><span class="line">            response.end()</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">readbody</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> data = <span class="string">''</span></span><br><span class="line">            request.on(<span class="string">'data'</span>, (chunk) =&gt; &#123;</span><br><span class="line">                data += chunk</span><br><span class="line">            &#125;).on(<span class="string">"end"</span>, () =&gt; &#123;</span><br><span class="line">                resolve(data)</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            *浏览器传数据是一段一段传的</span></span><br><span class="line"><span class="comment">            *所以要获取完整的数据得拼接起来</span></span><br><span class="line"><span class="comment">            *用Promise处理下，方便后面回调的使用</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>后端方面如果不借助框架或者库，自己处理起来会比较繁琐一点，但总体流程还是比较清晰的。</p>
<ol>
<li>拿到前端传过来的数据</li>
<li>进行验证</li>
<li>验证成功则写入数据库，并返回相关响应</li>
<li>失败则返回错误信息</li>
</ol>
<h2 id="登陆页面前端js代码"><a href="#登陆页面前端js代码" class="headerlink" title="登陆页面前端js代码"></a>登陆页面前端js代码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//jQuery</span></span><br><span class="line"><span class="keyword">let</span> $form = $(<span class="string">'#signIpForm'</span>)</span><br><span class="line">        $form.on(<span class="string">'submit'</span>, (e) =&gt; &#123;</span><br><span class="line">            e.preventDefault()</span><br><span class="line">            <span class="keyword">let</span> data = &#123;&#125;</span><br><span class="line">            <span class="keyword">let</span> accountInfo = [<span class="string">'userName'</span>, <span class="string">'password'</span>, <span class="string">'password_confirmation'</span>]</span><br><span class="line">            accountInfo.forEach(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> value = $form.find(<span class="string">`[name=<span class="subst">$&#123;name&#125;</span>]`</span>).val()</span><br><span class="line">                data[name] = value</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">//获取用户登录信息</span></span><br><span class="line">            $.post(<span class="string">'/sign_in'</span>, data)</span><br><span class="line">                .then(</span><br><span class="line">                    (reponse) =&gt; &#123;</span><br><span class="line">                        <span class="comment">// let userName = JSON.parse(reponse)</span></span><br><span class="line">                        <span class="built_in">console</span>.log(reponse)</span><br><span class="line">                        alert(<span class="string">'登陆成功'</span>)</span><br><span class="line">                        <span class="built_in">window</span>.location = <span class="string">'/index'</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    () =&gt; &#123;</span><br><span class="line">                        alert(<span class="string">'用户名或者密码错误，请重新输入'</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure>

<p>登陆流程跟注册流程大同小异，甚至还简单些。</p>
<h2 id="登录页面后端代码"><a href="#登录页面后端代码" class="headerlink" title="登录页面后端代码"></a>登录页面后端代码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//node.js</span></span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (path === <span class="string">"/sign_in"</span> &amp;&amp; method == <span class="string">"POST"</span>) &#123;</span><br><span class="line">        readbody(request).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> hash = &#123;&#125;</span><br><span class="line">            <span class="keyword">let</span> strings = data.split(<span class="string">'&amp;'</span>)</span><br><span class="line"></span><br><span class="line">            strings.forEach(<span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> parts = element.split(<span class="string">'='</span>)</span><br><span class="line">                <span class="keyword">let</span> key = parts[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">let</span> value = parts[<span class="number">1</span>]</span><br><span class="line">                hash[key] = value</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">let</span> &#123;</span><br><span class="line">                userName,</span><br><span class="line">                password,</span><br><span class="line">                password_confirmation</span><br><span class="line">            &#125; = hash</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> users = fs.readFileSync(<span class="string">'./db/db'</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                users = <span class="built_in">JSON</span>.parse(users) <span class="comment">// []</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (exception) &#123;</span><br><span class="line">                users = []</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(users)</span><br><span class="line">            <span class="keyword">let</span> found</span><br><span class="line">            users.forEach(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (e.userName === <span class="built_in">decodeURIComponent</span>(userName) &amp;&amp; e.password === <span class="built_in">decodeURIComponent</span>(password)) &#123;</span><br><span class="line">                    found = <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">//用粗暴的for循环匹配数据库的用户名及密码</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> name = <span class="built_in">decodeURIComponent</span>(userName)</span><br><span class="line">            <span class="keyword">if</span>(found === <span class="literal">true</span>)&#123;</span><br><span class="line">                response.setHeader(<span class="string">'Set-Cookie'</span>, <span class="string">`sign_in_userName=<span class="subst">$&#123;userName&#125;</span>`</span>)</span><br><span class="line">                <span class="comment">//设置cookie</span></span><br><span class="line">                response.statusCode = <span class="number">200</span></span><br><span class="line">                response.write(userName)</span><br><span class="line">                response.end()</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                response.statusCode = <span class="number">401</span></span><br><span class="line">                response.end()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br></pre></td></tr></table></figure>

<ol>
<li>获取前端传来的数据</li>
<li>与数据库的数据进行比对</li>
<li>比对成功的，则返回正确的信息</li>
<li>比对失败，返回错误信息</li>
</ol>
<h2 id="主页"><a href="#主页" class="headerlink" title="主页"></a>主页</h2><p>在注册登陆都成功的情况下，那么就允许用户进入主页面了。因为后端设置了cookie，所以此时我可以在前端拿到相对应的cookie信息。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> string = <span class="built_in">document</span>.cookie</span><br><span class="line"><span class="keyword">let</span> name = string.split(<span class="string">'='</span>)[<span class="number">1</span>]</span><br><span class="line">userName.innerText = name ? <span class="built_in">decodeURIComponent</span>(name) : <span class="string">'未定义用户名'</span></span><br></pre></td></tr></table></figure>

<center><img src="http://wx3.sinaimg.cn/mw690/0060lm7Tly1frl5mmbh8uj30cd06g3yr.jpg" alt="主页"></center>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>流程看似简单，但如果要用户体验好，会有很多需要优化的地方。梳理了一遍后，对流程的走向也更加清晰，这对他人写的框架库会有更好的认知，因为原理都懂了，万变不离其中。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/22/注册登陆基本流程/" data-id="cjx33319r000r1ld2u0cjlufp" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js-cookie/">js cookie</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-前端知识整理系列（9）：原型和类" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/15/前端知识整理系列（9）：原型和类/" class="article-date">
  <time datetime="2018-05-15T01:20:58.000Z" itemprop="datePublished">2018-05-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/15/前端知识整理系列（9）：原型和类/">前端基础知识整理系列（9）：原型和类</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>几大强类型语言例如Java、C++等都以面向对象的思想去写代码。JavaScript虽然也有借鉴，但其一大特色就是有原型这个东西。</p>
<h2 id="原型"><a href="#原型" class="headerlink" title="原型"></a>原型</h2><p>JS中的原型平时你感觉好像没怎么接触，其实在写的过程中无时无刻不用得到它。</p>
<p>举个简单的例子</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">array.push(<span class="number">4</span>)</span><br><span class="line"><span class="built_in">console</span>.log(array) <span class="comment">//[1,2,3,4]</span></span><br></pre></td></tr></table></figure>

<p>有没想过push这个方法到底是怎么存在的呢？我们没有定义过这个push方法，为什么能使用呢？</p>
<p>因为这些方法都已经定义在了数组的原型上了。</p>
<center><img src="http://wx2.sinaimg.cn/large/90cb06dbly1frbq1330xzj20880573yq.jpg"></center>

<p>打印出array，打开开发者工具，查看<strong>proto</strong>，这里面可以看见一系列的方法，其中push也是包括在内的。</p>
<p>所以，即使没有定义过push方法，我们仍然可以使用，因为这个方法已被在数组的原型上定义好了;<strong>如果在当前环境内，没有找到push方法，则会沿着原型链继续查找。</strong></p>
<p>使用原型的好处是省内存，因为对象的操作方法都是这么几种，如果每个对象都的方法重新定义一次，这样会占用很高的内存。所以开发者把常用的方法定义到原型上，每个对象在使用这些方法时只要找到同一个原型那就能使用了。相对于定义多次相同的方法，只定义一个原型那肯定简便的多。</p>
<h2 id="定义一个原型"><a href="#定义一个原型" class="headerlink" title="定义一个原型"></a>定义一个原型</h2><p>定义一个原型很简单，只要用prototype属性就行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;&#125;</span><br><span class="line">obj.prototype = &#123;</span><br><span class="line">    a: <span class="number">2</span>,</span><br><span class="line">    b: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="number">3</span>)&#125;,</span><br><span class="line">    c: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.a <span class="comment">//2</span></span><br><span class="line">obj.b() <span class="comment">//3</span></span><br></pre></td></tr></table></figure>

<p>可以看出，定义了对象的原型之后，就能使用原型上的属性跟方法。</p>
<h2 id="类"><a href="#类" class="headerlink" title="类"></a>类</h2><p>如果我们理解了原型，那么对类理解起来会相对简单很多。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">    a: <span class="number">1</span>,</span><br><span class="line">    b: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">'你好'</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">    a: <span class="number">2</span>,</span><br><span class="line">    b: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">'你好'</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj3 = &#123;</span><br><span class="line">    a: <span class="number">3</span>,</span><br><span class="line">    b: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">'你好'</span>)&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>假设有obj1、obj2、obj3三个不同的对象，如果都使用b这个方法，上面的代码是方法之一，就是每个对象里面都定义b方法，但这样会显得繁琐，如果用类就简单多了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Obj</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.a = x <span class="comment">//this指向新构建的对象</span></span><br><span class="line">&#125;</span><br><span class="line">Obj.prototype.b = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">'你好'</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = <span class="keyword">new</span> Obj(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">var</span> obj2 = <span class="keyword">new</span> Obj(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">var</span> obj3 = <span class="keyword">new</span> Obj(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">obj1.a <span class="comment">//1</span></span><br><span class="line">obj2.a <span class="comment">//2</span></span><br><span class="line">obj1.b() <span class="comment">//"你好"</span></span><br><span class="line">obj2.b() <span class="comment">//"你好"</span></span><br></pre></td></tr></table></figure>

<p>通过构造函数，定义了私有属性及方法，然后公有方法通过原型去共享，这样就能模拟一个类出来。</p>
<h2 id="类实际运用"><a href="#类实际运用" class="headerlink" title="类实际运用"></a>类实际运用</h2><p>小的方面，我们可以利用类减少重复代码，让代码结构更清晰，而且让代码更容易复用。</p>
<p>大的方面，可以构建一个框架，参照下Vue的语法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    message: <span class="string">'Hello Vue!'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Vue其实再抽象了一层，不过也能看到类的影子，el、data的属性是共有的，每个模块都有，通过new Vue构造出来的对象就是属于Vue这个类的。</p>
<h2 id="es6的类"><a href="#es6的类" class="headerlink" title="es6的类"></a>es6的类</h2><p>因为es5没有类这个概念，平时使用只能模拟出来，而es6定义了类这个模块。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Obj</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(x) &#123;</span><br><span class="line">        <span class="keyword">this</span>.a = x;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    b() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`你好`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj1 = <span class="keyword">new</span> Obj(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> obj2 = <span class="keyword">new</span> Obj(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>es6的类转译到es5的写法其实是差不多的，就是要实现同样的功能。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/15/前端知识整理系列（9）：原型和类/" data-id="cjx33319p000n1ld2grw1lhd1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js-原型-类/">js 原型 类</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-前端基础知识整理系列（8）：AJAX" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/03/前端基础知识整理系列（8）：AJAX/" class="article-date">
  <time datetime="2018-05-02T19:05:55.000Z" itemprop="datePublished">2018-05-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/03/前端基础知识整理系列（8）：AJAX/">前端基础知识整理系列（8）：AJAX</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>AJAX全名为 Asynchronous Javascript and XML，中文译名异步的Javascript和XML。<br>其实在JSON语言被发明出来之前，前后端数据交互用的是XML，随着JSON被发明，XML逐渐被这一更简单易用的语言所取代。</p>
<p>这次记录下怎么写一个常规的AJAX请求。</p>
<h2 id="HTTP请求头"><a href="#HTTP请求头" class="headerlink" title="HTTP请求头"></a>HTTP请求头</h2><p>用AJAX，就是为了发一个HTTP请求，所以必须对HTTP有所了解。先简单介绍下HTTP报文所代表的含义.</p>
<p><a href="https://blog.csdn.net/u010256388/article/details/68491509" target="_blank" rel="noopener">附上链接</a></p>
<h2 id="AJAX基本写法"><a href="#AJAX基本写法" class="headerlink" title="AJAX基本写法"></a>AJAX基本写法</h2><p>对HTTP有了大概的了解后，学习AJAX就简单多了~</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> request = <span class="keyword">new</span> XMLHttpRequest() </span><br><span class="line"><span class="comment">//XMLHttpRequest()是客户端提供用于数据传输的API</span></span><br><span class="line"></span><br><span class="line">request.open(method,url) </span><br><span class="line"><span class="comment">//method为请求方法</span></span><br><span class="line"><span class="comment">//url是请求地址或者路径</span></span><br><span class="line"></span><br><span class="line">request.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//onreadystatechange监听请求状态的改变，readyState为4表示请求完成，但不能判断请求是否成功，只能说明请求完成了</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (request.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (request.status === <span class="number">200</span> ) &#123;</span><br><span class="line">            <span class="comment">//如果请求完毕，且状态码返回2xx，表示请求成功</span></span><br><span class="line">                <span class="keyword">let</span> string = request.responseText</span><br><span class="line">                <span class="keyword">let</span> object = <span class="built_in">JSON</span>.parse(string)</span><br><span class="line">                success.call(<span class="literal">undefined</span>, object)</span><br><span class="line">                <span class="comment">//回调函数，在请求成功时调用，参数传入后端返回的JSON解析数据</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (request.status &gt; <span class="number">400</span>) &#123;</span><br><span class="line">            <span class="comment">//如果请求完毕，且状态码返回4xx，表示请求失败</span></span><br><span class="line">                fail.call(<span class="literal">undefined</span>, request)</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request.send(body)</span><br><span class="line"><span class="comment">//设置请求体，向服务端发送</span></span><br></pre></td></tr></table></figure>

<p>这就是AJAX基本写法。</p>
<h2 id="封装一个AJAX函数"><a href="#封装一个AJAX函数" class="headerlink" title="封装一个AJAX函数"></a>封装一个AJAX函数</h2><p>自己封装一个AJAX函数，方便以后工作使用，以免用的时候才去查API。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.zwq = &#123;&#125;</span><br><span class="line"><span class="comment">//命名空间</span></span><br><span class="line"></span><br><span class="line">zwq.ajax = <span class="function"><span class="keyword">function</span>(<span class="params">method,url,body,success,fail</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> request = <span class="keyword">new</span> XMLHttpRequest() </span><br><span class="line"></span><br><span class="line">    request.open(method,url) </span><br><span class="line"></span><br><span class="line">    request.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (request.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (request.status === <span class="number">200</span> ) &#123;</span><br><span class="line">                    <span class="keyword">let</span> string = request.responseText</span><br><span class="line">                    <span class="keyword">let</span> object = <span class="built_in">JSON</span>.parse(string)</span><br><span class="line">                    success.call(<span class="literal">undefined</span>, object)</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (request.status &gt; <span class="number">400</span>) &#123;</span><br><span class="line">                    fail.call(<span class="literal">undefined</span>, request)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request.send(body)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*下面是函数调用*/</span></span><br><span class="line"></span><br><span class="line">zwq.ajax(</span><br><span class="line"><span class="string">'GET'</span>,</span><br><span class="line"><span class="string">'/xxx'</span>,</span><br><span class="line"><span class="string">'你好呀'</span>,</span><br><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">text</span>)</span>&#123;<span class="built_in">console</span>.log(text)&#125;,</span><br><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">request</span>)</span>&#123;<span class="built_in">console</span>.log(request)&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>可以看出，常规的封装，在调用的时候很麻烦，而且信息不明确，不去看源代码根本不知道每个参数所代表的意思。</p>
<p>优化一下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.zwq = &#123;&#125;</span><br><span class="line"><span class="comment">//命名空间</span></span><br><span class="line"></span><br><span class="line">zwq.ajax = <span class="function"><span class="keyword">function</span>(<span class="params">&#123;method,url,body,success,fail&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//es6解构赋值</span></span><br><span class="line">    <span class="keyword">let</span> request = <span class="keyword">new</span> XMLHttpRequest() </span><br><span class="line"></span><br><span class="line">    request.open(method,url) </span><br><span class="line"></span><br><span class="line">    request.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (request.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (request.status === <span class="number">200</span> ) &#123;</span><br><span class="line">                    <span class="keyword">let</span> string = request.responseText</span><br><span class="line">                    <span class="keyword">let</span> object = <span class="built_in">JSON</span>.parse(string)</span><br><span class="line">                    success.call(<span class="literal">undefined</span>, object)</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (request.status &gt; <span class="number">400</span>) &#123;</span><br><span class="line">                    fail.call(<span class="literal">undefined</span>, request)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request.send(body)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*下面是函数调用*/</span></span><br><span class="line"></span><br><span class="line">zwq.ajax(&#123;</span><br><span class="line">    method:<span class="string">'GET'</span>,</span><br><span class="line">    url:<span class="string">'/xxx'</span>,</span><br><span class="line">    body:<span class="string">'你好呀'</span>,</span><br><span class="line">    success:<span class="function"><span class="keyword">function</span>(<span class="params">text</span>)</span>&#123;<span class="built_in">console</span>.log(text)&#125;,</span><br><span class="line">    fail:<span class="function"><span class="keyword">function</span>(<span class="params">request</span>)</span>&#123;<span class="built_in">console</span>.log(request)&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这样，在调用的时候传入一个对象，把数据整合起来，看起来就很统一很明确了。</p>
<h2 id="借鉴jQuery的AJAX封装"><a href="#借鉴jQuery的AJAX封装" class="headerlink" title="借鉴jQuery的AJAX封装"></a>借鉴jQuery的AJAX封装</h2><p>先看一下jQuery的AJAX调用方式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">jQuery.ajax(&#123;</span><br><span class="line">    method:<span class="string">'GET'</span>,</span><br><span class="line">    url:<span class="string">'/xxx'</span>,</span><br><span class="line">    body:<span class="string">'你好呀'</span></span><br><span class="line">&#125;).then(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">text</span>)</span>&#123;<span class="built_in">console</span>.log(text)&#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">request</span>)</span>&#123;<span class="built_in">console</span>.log(request)&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>把回调函数分离出来，便于书写管理，这个到底怎么实现呢？</p>
<p>其实用Promise就行了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.zwq = &#123;&#125;</span><br><span class="line"><span class="comment">//命名空间</span></span><br><span class="line"></span><br><span class="line">zwq.ajax = <span class="function"><span class="keyword">function</span>(<span class="params">&#123;method,url,body,success,fail&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//es6解构赋值</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//约定Promise对象所传入函数的参数为resolve跟reject</span></span><br><span class="line">    <span class="comment">//resolve为成功所执行的函数，reject为失败所执行的函数</span></span><br><span class="line">        <span class="keyword">let</span> request = <span class="keyword">new</span> XMLHttpRequest() </span><br><span class="line"></span><br><span class="line">        request.open(method,url) </span><br><span class="line">    </span><br><span class="line">        request.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (request.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (request.status === <span class="number">200</span> ) &#123;</span><br><span class="line">                        <span class="keyword">let</span> string = request.responseText</span><br><span class="line">                        <span class="keyword">let</span> object = <span class="built_in">JSON</span>.parse(string)</span><br><span class="line">                        resolve.call(<span class="literal">undefined</span>, object)</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (request.status &gt; <span class="number">400</span>) &#123;</span><br><span class="line">                        reject.call(<span class="literal">undefined</span>, request)</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        request.send(body)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*下面是函数调用*/</span></span><br><span class="line"></span><br><span class="line">zwq.ajax(&#123;</span><br><span class="line">    method:<span class="string">'GET'</span>,</span><br><span class="line">    url:<span class="string">'/xxx'</span>,</span><br><span class="line">    body:<span class="string">'你好呀'</span></span><br><span class="line">&#125;).then(</span><br><span class="line">    (text)=&gt;&#123;<span class="built_in">console</span>.log(text)&#125;,</span><br><span class="line">    (request)=&gt;&#123;<span class="built_in">console</span>.log(request)&#125;</span><br><span class="line">)</span><br><span class="line"><span class="comment">//Promise对象返回附带有then的方法，所以可以这样调用</span></span><br></pre></td></tr></table></figure>

<p>这样就能简单模拟jQuery的AJAX方法发请求了<del>~</del></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/03/前端基础知识整理系列（8）：AJAX/" data-id="cjx33319m000k1ld2ti5jh9sq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JS-AJAX/">JS AJAX</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-前端基础知识整理系列（7）：JSONP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/28/前端基础知识整理系列（7）：JSONP/" class="article-date">
  <time datetime="2018-04-28T15:07:13.000Z" itemprop="datePublished">2018-04-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/28/前端基础知识整理系列（7）：JSONP/">前端基础知识整理系列（7）：JSONP</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>浏览器为了安全的目的，制定了同源政策。这是为了保证用户信息安全，防止恶意的网站窃取数据。(<a href="http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html" target="_blank" rel="noopener">阮一峰 浏览器同源政策及其规避方法</a>)</p>
<p>但实际工作中，我们避免不了在不同源的客户端跟服务端进行信息交互。所以前辈们想出了许多办法去规避同源政策，今天我先介绍第一种跨域方法-JSONP。</p>
<h2 id="历史"><a href="#历史" class="headerlink" title="历史"></a>历史</h2><p>其实在2005年AJAX出现之前，已经有程序员发明出了JSONP，目的就是为了优化用户体验。在JSONP发明之前，还有更多的可代替方案，虽然随着技术迭代已经消声灭迹，但我觉得还是有必要提及下，这能更好的理解新技术发明解决的痛点。</p>
<h3 id="form表单"><a href="#form表单" class="headerlink" title="form表单"></a>form表单</h3><p>我们知道form表单有action属性，可以触发http请求。最早的时候，前后端数据交互都是基于这个形式。</p>
<p>前端想向后端请求一个数据，那么写一个form表单，然后提交触发，后端收到请求后返回响应。</p>
<p>但是form表单在提交的时候会刷新页面，用户体验不好，注重体验的那批程序员想了一种方法，那就是通过html标签元素触发http请求。</p>
<h3 id="img标签发送请求"><a href="#img标签发送请求" class="headerlink" title="img标签发送请求"></a>img标签发送请求</h3><p>浏览器在碰到有img标签的时候，会自动向服务器发起请求，所以这就是可以利用的。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>余额：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"balance"</span>&gt;</span>100<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"paymentBtn"</span>&gt;</span>付款<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*javascript代码*/</span></span><br><span class="line">paymentBtn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>)</span><br><span class="line">    img.src = <span class="string">'/pay'</span></span><br><span class="line"></span><br><span class="line">    img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">'success'</span>)</span><br><span class="line">        balance.innerText = <span class="built_in">parseInt</span>(balance.innerText<span class="number">-1</span>,<span class="number">10</span>) </span><br><span class="line">        <span class="comment">//响应成功则余额减1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    img.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">'fail'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只要在script标签内创建一个img标签，在此标签加载的时候会发起请求，后端收到请求，返回响应结果。如果状态码返回2xx，那么说明这次请求成功，前端便会执行img.onload的代码。</p>
<p>虽然达到了通信效果，但这样后端必须传回一个真实的img文件浏览器才会认为响应成功。</p>
<p>还有其他方式吗？</p>
<h3 id="script标签"><a href="#script标签" class="headerlink" title="script标签"></a>script标签</h3><p>可以发送请求的标签，除了img，还有a、link、script等等。a标签因为需要点击，所以排除。那剩下的选择也不多了，就想到了用script来代替。</p>
<p>到了这一步，其实离JSONP已经很接近了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*javascript代码*/</span></span><br><span class="line"><span class="built_in">window</span>.xxx = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(data===<span class="string">'success'</span>)&#123;</span><br><span class="line">        alert(<span class="string">'这是前端代码，数据是'</span>+data)</span><br><span class="line">        balance.innerText = <span class="built_in">parseInt</span>(balance.innerText<span class="number">-1</span>,<span class="number">10</span>) </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">paymentBtn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span><br><span class="line">    script.src = <span class="string">'/pay'</span></span><br><span class="line">    docuent.body.appendChild(script)</span><br><span class="line">    <span class="comment">//script必须在页面中才能发起请求</span></span><br><span class="line">    </span><br><span class="line">    script.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">'success'</span>)</span><br><span class="line">        e.currentTarget.remove()  <span class="comment">//清除script标签</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    img.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">'fail'</span>)</span><br><span class="line">        e.currentTarget.remove()  <span class="comment">//清除script标签</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样的方法跟img很类似，但是通过创建script标签可以做更多的事情。</p>
<p>先看下后端代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//node.js</span></span><br><span class="line"><span class="keyword">if</span> (path === <span class="string">'/pay'</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> balance = fs.readFileSync(<span class="string">'./db'</span>, <span class="string">'utf8'</span>)</span><br><span class="line">        <span class="comment">//db文件只存了数值100，为了模拟数据库的作用</span></span><br><span class="line">        <span class="keyword">var</span> newBalance = balance - <span class="number">1</span></span><br><span class="line">        fs.writeFileSync(<span class="string">'./db'</span>, newBalance)</span><br><span class="line">        </span><br><span class="line">        response.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/javascript'</span>)</span><br><span class="line">        response.statusCode = <span class="number">200</span></span><br><span class="line">        response.write(<span class="string">`</span></span><br><span class="line"><span class="string">            xxx.call(undefined,'success')</span></span><br><span class="line"><span class="string">        `</span>)<span class="comment">//向前端传的date是'success'</span></span><br><span class="line">    </span><br><span class="line">        response.end()</span><br><span class="line">    ｝</span><br></pre></td></tr></table></figure>

<p>但这个有点不好的是，前后端会耦合在一起，因为后端程序员必须去知道前端传过来函数的名字xxx，才能相应的返回数据。</p>
<p>为了解耦，因此约定，统一传过来的函数名为callback，后端通过查询参数获得，这就是JSONP。</p>
<h2 id="JSONP（JSON-padding）"><a href="#JSONP（JSON-padding）" class="headerlink" title="JSONP（JSON + padding）"></a>JSONP（JSON + padding）</h2><p>因为script标签的请求不受域名限制，所以不同源之间的通信可以利用这一点。</p>
<p><strong>JSONP定义：通过动态创建script元素，插入到页面中，在加载时向服务器请求数据；服务器收到请求后，通过指定名字的回调函数将数据传回来。</strong></p>
<p>前端代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">paymentBtn.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> functionName = <span class="string">'banlance'</span>+ <span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random()*<span class="number">100000</span>,<span class="number">10</span>)</span><br><span class="line">    <span class="comment">//定义随机的回调函数名</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">window</span>[functionName] = <span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(result === <span class="string">'success'</span>)&#123;   </span><br><span class="line">            <span class="comment">// alert('这是前端写的代码')</span></span><br><span class="line">            balance.innerText = <span class="built_in">parseInt</span>(balance.innerText<span class="number">-1</span>,<span class="number">10</span>) </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            alert(<span class="string">'页面出错'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    script.src = <span class="string">'http://127.0.0.1:8081/pay?callback='</span>+functionName</span><br><span class="line">    <span class="comment">//本身的域名端口为 http://127.0.0.1:80，因为端口号不同，所以不是统一个源</span></span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(script)</span><br><span class="line"></span><br><span class="line">    script.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        e.currentTarget.remove()</span><br><span class="line">        <span class="keyword">delete</span> <span class="built_in">window</span>[functionName]</span><br><span class="line">        <span class="comment">//执行完毕删除回调函数</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    script.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">'fail'</span>)</span><br><span class="line">        e.currentTarget.remove()</span><br><span class="line">        <span class="keyword">delete</span> <span class="built_in">window</span>[functionName]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>后端代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (path === <span class="string">'/pay'</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> balance = fs.readFileSync(<span class="string">'./db'</span>, <span class="string">'utf8'</span>)</span><br><span class="line">    <span class="keyword">var</span> newBalance = balance - <span class="number">1</span></span><br><span class="line">    fs.writeFileSync(<span class="string">'./db'</span>, newBalance)</span><br><span class="line">    response.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/javascript'</span>)</span><br><span class="line">    response.statusCode = <span class="number">200</span></span><br><span class="line">    response.write(<span class="string">`</span></span><br><span class="line"><span class="string">        <span class="subst">$&#123;query.callback&#125;</span>.call(undefined,'success')</span></span><br><span class="line"><span class="string">    `</span>)</span><br><span class="line"></span><br><span class="line">    response.end()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样不管我前端写的函数名是什么，后端通过查询callback就能得到，从而达到通信的效果。</p>
<p><strong>为什么叫做JSONP呢，其实后端返回的格式不一定是JSON格式的字符串，也可以是其他的形式。只是工作中，JSON作为一门数据交换语言已经被广泛应用，一般来说后端返回的是JSON格式的字符串方便前端处理，用的多了，也就叫做JSONP了，严格来说跟JSON没多大关系。</strong></p>
<h3 id="jQuery实现"><a href="#jQuery实现" class="headerlink" title="jQuery实现"></a>jQuery实现</h3><p>jQuery写法很简单，因为其帮我们封装了一系列的代码，节省了步骤。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$(paymentBtn).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url: <span class="string">"http://127.0.0.1:8081/pay"</span>,</span><br><span class="line">        dataType: <span class="string">"jsonp"</span>,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (result === <span class="string">'success'</span>) &#123;</span><br><span class="line">                <span class="comment">// alert('这是前端写的代码')</span></span><br><span class="line">                balance.innerText = <span class="built_in">parseInt</span>(balance.innerText - <span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        error: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            alert(<span class="string">'fail'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>不用写查询参数，也不用在script加载完后删除，jQuery都帮我们做好了~~</p>
<p><em>ps：JSONP只能用get方法做请求，因为创建script没有提供其他的api，默认就是 get方法</em></p>
<h2 id="感受"><a href="#感受" class="headerlink" title="感受"></a>感受</h2><p>前端的发展能到今天，真的是离不开各位前辈们苦思冥想的铺垫。如果不是有追求极致的人，那么或许今天的交互还停留在表单提交的状态。</p>
<p>所以一直抱着敬畏之心去学习，虽然陈旧的技术被淘汰，但我还是愿意去了解它们，因为这些是当时前辈们的思想火花，对前端发展有重要的参考意义。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/28/前端基础知识整理系列（7）：JSONP/" data-id="cjx33319l000i1ld2p39uyfnz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-作用域与闭包" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/13/作用域与闭包/" class="article-date">
  <time datetime="2018-04-13T11:02:30.000Z" itemprop="datePublished">2018-04-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/13/作用域与闭包/">前端基础知识整理系列（6）: 作用域及闭包</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>终于到闭包了<del>不过学习闭包之前得理解什么是作用域</del></p>
<h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2><p>作用域可以说是js的一套规则，主要用于确定在何处以及如何查找变量，也可以说是变量存在的范围。</p>
<p>来看一组代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">3</span></span><br><span class="line">    <span class="built_in">console</span>.log(a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo() <span class="comment">//2</span></span><br><span class="line"><span class="built_in">console</span>.log(b) <span class="comment">//b is not defined</span></span><br></pre></td></tr></table></figure>

<p>为什么打印b出错显示未定义，然后a明明不在函数里面为什么可以打印出来？</p>
<p><strong>在ES5规范中，作用域主要分为全局作用域跟函数作用域。</strong></p>
<p>变量在作用域中的查找方式是单向的，从内到外。当你在一个函数内部查找一个变量，首先会在当前作用域查找，如果未找到，则会向上一层继续查找，直到全局作用域这一层为止，如果还未找到，则就会抛出异常。同时因为是单向的，所以外部是不能获取到内部作用域变量的。</p>
<p>因此上一组代码，在foo函数内，需要找到a这个变量，首先会在当前函数作用域内查找，然后当前作用域没有找到a，则会向上一层作用域也就是全局作用域查找，然后找到a，打印出来。</p>
<p>而在全局作用域中，需要查找变量b，因为全局作用域是最顶层了，没有上一层，所以在这层找不到的话则会抛出异常。</p>
<p>再来看一组代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> c = <span class="number">3</span></span><br><span class="line">        <span class="built_in">console</span>.log(a,b,c)</span><br><span class="line">    &#125;</span><br><span class="line">    bar() <span class="comment">//1,2,3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>

<p>有多个作用域嵌套，然后适用于从内部向外部查找规则的，可以称作为「作用域链」。即一个内部作用域，可以通过作用域链一直向上层查找，直到全局作用域为止。</p>
<center><img src="https://s1.ax2x.com/2018/04/13/NRm1e.png" alt="作用域链" border="0"></center>

<h3 id="经典作用域考察题目"><a href="#经典作用域考察题目" class="headerlink" title="经典作用域考察题目"></a>经典作用域考察题目</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"child1"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"child2"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"child3"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> childs = <span class="built_in">document</span>.querySelectorAll(<span class="string">'#parent&gt;div'</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i&lt;childs.length; i++)&#123;</span></span><br><span class="line"><span class="javascript">    childs[i].onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(i) <span class="comment">//?</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>一般第一次接触的时候，会理所当然的认为会打印出0，1，2。实际上呢，是打印出了3个3。</p>
<p>因为在点击childs之前，i的值是不确定的，只能说确定要到上一层找到变量i，i的值是多少不确定。也就是说赋值操作肯定是比点击childs要早，所以找到i的时候是赋值操作完成后的那个结果。</p>
<p>简化一下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> childs = <span class="built_in">document</span>.querySelectorAll(<span class="string">'#parent&gt;div'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span> &lt; <span class="number">3</span>? <span class="comment">// true</span></span><br><span class="line">childs[<span class="number">0</span>].onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i) <span class="comment">//3</span></span><br><span class="line">    &#125;<span class="comment">//未执行</span></span><br><span class="line">i = i + <span class="number">1</span> <span class="comment">// i = 1</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span> &lt; <span class="number">3</span>? <span class="comment">// true</span></span><br><span class="line">childs[<span class="number">1</span>].onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i) <span class="comment">//3</span></span><br><span class="line">    &#125;<span class="comment">//未执行</span></span><br><span class="line">i = i + <span class="number">1</span> <span class="comment">// i = 2</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span> &lt; <span class="number">3</span>? <span class="comment">// true  </span></span><br><span class="line">childs[<span class="number">2</span>].onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i) <span class="comment">//3</span></span><br><span class="line">    &#125;<span class="comment">//未执行</span></span><br><span class="line">i = i + <span class="number">1</span> <span class="comment">// i = 3</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span> &lt; <span class="number">3</span>? <span class="comment">//false</span></span><br></pre></td></tr></table></figure>

<p>因为ES5中还没有块级作用域，所以for循环中声明的i变量是全局变量；当点击事件发生的时候，i已经完成了赋值操作，i的值为3，这时候通过作用域链找到全局变量的i也就是3了。</p>
<p>改进：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> childs = <span class="built_in">document</span>.querySelectorAll(<span class="string">'#parent&gt;div'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i&lt;childs.length; i++)&#123;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">        childs[i].onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i)</span><br><span class="line">        &#125;)(i)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用立即执行函数，创造一个函数作用域。在每次i值改变的时候，都把i的值保存到内部的函数作用域中，因为立即执行函数跟i赋值的时候可以说是同步执行的，然后触发点击事件的时候，就会拿到函数作用域中的i。（参数也是在函数作用域内的）</p>
<p>再简化：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> childs = <span class="built_in">document</span>.querySelectorAll(<span class="string">'#parent&gt;div'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span> &lt; <span class="number">3</span>? <span class="comment">// true</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> j = i <span class="comment">// i = 0</span></span><br><span class="line">    childs[j].onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(j) <span class="comment">//0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(i)</span><br><span class="line"></span><br><span class="line">i = i + <span class="number">1</span> <span class="comment">// i = 1</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span> &lt; <span class="number">3</span>? <span class="comment">// true</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> j = i <span class="comment">// i = 1</span></span><br><span class="line">    childs[j].onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(j) <span class="comment">//1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(i)</span><br><span class="line">i = i + <span class="number">1</span> <span class="comment">// i = 2</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span> &lt; <span class="number">3</span>? <span class="comment">// true  </span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> j = i <span class="comment">// i = 2</span></span><br><span class="line">    childs[j].onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(j) <span class="comment">//2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(i)</span><br><span class="line">i = i + <span class="number">1</span> <span class="comment">// i = 3</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span> &lt; <span class="number">3</span>? <span class="comment">//false</span></span><br></pre></td></tr></table></figure>

<h2 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h2><p>如果对作用域理解了，那么对闭包理解起来就很容易。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(a)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bar</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> baz = foo()</span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">//a is not defined</span></span><br><span class="line">baz() <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<p>先来整理下整个结构。</p>
<p>全局作用域：包含了函数对象foo；全局变量baz，变量baz的值是foo函数的返回值；console.log函数对象。</p>
<p>函数foo作用域：包含了局部变量a，a的值是1；函数对象bar；</p>
<p>函数bar作用域：包含了console.log函数对象。</p>
<hr>
<p>根据作用域的规则，全局对象是不能向函数foo查找变量a的，所以console.log(a)会报错，虽然a存在，但是存在与函数作用域中而不是全局作用域。</p>
<p>那么是不是外部就一定不能获取内部作用域中的变量呢？</p>
<p>按规则来说是的，但可以通过一些技巧间接在外部获取内部的变量，这个技巧就是用闭包。</p>
<p><strong>1.通过在foo函数内，声明一个bar函数，foo函数的返回值是bar函数地址。</strong></p>
<p><strong>2.声明全局变量baz，把foo函数的执行返回值赋值给baz全局变量，即baz保存的是bar函数地址。</strong></p>
<p><strong>3.执行baz，也就是执行了bar函数，bar函数通过作用域链找到foo函数内的a变量，所以在全局作用域中显示出了a的值。</strong></p>
<p>所以这就是个闭包，它通过返回另一个函数，使得外部能获得内部作用域中的变量，本质上，闭包就是将函数内部和函数外部连接起来的一座桥梁。</p>
<p> JS 的函数内部可以使用函数外部的变量，所以这段代码正好符合了闭包的定义。而不是 JS 故意要使用闭包。</p>
<h3 id="闭包总结"><a href="#闭包总结" class="headerlink" title="闭包总结"></a>闭包总结</h3><p> <strong>闭包定义：「函数」和「函数内部能访问到的变量」（也叫环境）的总和，就是一个闭包。</strong></p>
<p> 作用：</p>
<p><strong>1.隐藏变量，但通过返回方法，使外部可以访问或者操作这个变量。</strong></p>
<p><strong>2.封装对象的私有属性和方法。</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _age;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setAge</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    _age = n;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getAge</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: name,</span><br><span class="line">    getAge: getAge,</span><br><span class="line">    setAge: setAge</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = Person(<span class="string">'张三'</span>);</span><br><span class="line">p1.setAge(<span class="number">25</span>);</span><br><span class="line">p1.getAge() <span class="comment">// 25</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*转自阮一峰的javascript标准参考教程*/</span></span><br></pre></td></tr></table></figure>

<p>上面代码中，函数Person的内部变量_age，通过闭包getAge和setAge，变成了返回对象p1的私有变量。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/13/作用域与闭包/" data-id="cjx33319b00051ld28te69fmt" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-移动端适配" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/10/移动端适配/" class="article-date">
  <time datetime="2018-04-10T11:38:10.000Z" itemprop="datePublished">2018-04-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/10/移动端适配/">移动端适配及兼容</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>我接触的第一个项目，就是移动端项目。完成了这个项目之后，只有一个感受，一夜长大~~</p>
<p>在完全没有接触过的基础下，踩了无数多坑，一点一点摸索过来了，当时为了完成这个不算大的项目，连续通宵了一个星期，平均每天睡三四个小时吧，其他的时间都用在填坑上。</p>
<p>在工作以来，接触的移动端项目慢慢多了，最后在自己总结加前人经验的基础上，摸索出了一套适合常规的移动端适配方案。</p>
<h2 id="meta标签"><a href="#meta标签" class="headerlink" title="meta标签"></a>meta标签</h2><p>刚开始前端练习代码主要是针对pc端上的，因为比较直观，可以直接在浏览器显示，所以那时候对meta标签没有太大的留意。</p>
<p>其实meta标签主要用来指定一些信息，例如编码格式、编译语言等等。</p>
<p>在移动端上，它还有一个很重要的作用，就是指定内容宽度为设备宽度，如果不指定，在移动端浏览器上的内容宽度会默认为980px，元素变小等等。（有兴趣可了解下分辨率、物理像素、css像素之间的关系）</p>
<p>即：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1, user-scalable=no"</span> /&gt;</span></span><br><span class="line">/*</span><br><span class="line">*width = device-width  指定内容宽度为设备宽度</span><br><span class="line">*initial-scale = 1  指定初始缩放为1倍，即不缩放</span><br><span class="line">*user-scalable = no  禁止用户缩放</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<p>结论就是做移动端页面的时候必须加上这个meta标签，曾经也是不知道有这个东西忙活了大半天。。</p>
<h2 id="media媒体查询"><a href="#media媒体查询" class="headerlink" title="media媒体查询"></a>media媒体查询</h2><p>media媒体查询可以理解为打断点，在某个阶段执行某段css代码。</p>
<p>有两种形式：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">media</span>=<span class="string">"screen and (min-width: 900px)"</span> <span class="attr">href</span>=<span class="string">"widescreen-styles.css"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--在设备宽度小于900px的时候执行这一个widescreen-styles文件--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">@media screen and (min-width: 900px) &#123;</span><br><span class="line">  article &#123;</span><br><span class="line">    padding: 1rem 3rem;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">/*在设备宽度小于900px的时候执行这段css代码*/</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在学习rem之前，一直用media来做适配，就是写很多套css样式来兼容不同宽度的设备。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">@media screen and (max-width: 768px) &#123;</span><br><span class="line">  article &#123;</span><br><span class="line">    padding: 3rem 8rem;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (max-width: 414px) &#123;</span><br><span class="line">  article &#123;</span><br><span class="line">    padding: 2rem 5rem;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (max-width: 375px) &#123;</span><br><span class="line">  article &#123;</span><br><span class="line">    padding: 1.5rem 4rem;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (max-width: 320px) &#123;</span><br><span class="line">  article &#123;</span><br><span class="line">    padding: 1rem 3rem;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样写起来很麻烦，而且调试也不方便，不方便后期维护，现在不推荐这种方式来做移动端适配，不过如果测试的时候在某个机型下布局出现问题的话，可以适当的用媒体查询来解决。</p>
<h2 id="flex布局"><a href="#flex布局" class="headerlink" title="flex布局"></a>flex布局</h2><p>这个是经验之谈了，拿到设计稿的第一时间，不是撸起袖子就是干，得先分析下页面布局。</p>
<p>自从有了flex弹性盒子，前端的布局真的是简便了许多，相对于传统的float布局，bug少，而且特别适合做适配这一块。</p>
<p>flex弹性盒子的网上也有许多人做出了详细的教程，在这里不多加赘述，可自行搜索。</p>
<p>要注意的是一个页面元素，能不定宽高的就不定宽高，例如横向需要排列三个宽高为100px的矩形盒子，传统float做法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">div.parent&#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    overflow: hidden; //清除浮动</span><br><span class="line">&#125;</span><br><span class="line">div.child&#123;</span><br><span class="line">    float: left;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    margin-left: 20px</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<center>
<img src="https://s1.ax2x.com/2018/04/11/NBgGX.png" alt="float布局（ip6/7/8效果图）" border="0">
</center>

<center>
<img src="https://s1.ax2x.com/2018/04/11/NB7wy.png" alt="float布局（ip6/7/8 plus效果图）" border="0">
</center>

<p>定死宽高后，可能在设计稿的那个尺寸下没问题，但如果大一点或者小一点的情况下布局就会乱，这时候得插入多个媒体查询去解决。</p>
<p>如果用flex就简便很多。</p>
<p>flex布局</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">div.parent&#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-around;</span><br><span class="line">&#125;</span><br><span class="line">div.child&#123;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    background: red;</span><br><span class="line">    border: 1px solid black;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<center>
<img src="https://s1.ax2x.com/2018/04/11/NFQ8S.png" alt="flex布局（ip6/7/8效果图）" border="0">
</center>

<center>
<img src="https://s1.ax2x.com/2018/04/11/NFdHh.png" alt="flex布局（ip6/7/8 plus效果图）" border="0">
</center>


<p>这样就不用考虑margin这些乱七八糟的东西，但是因为盒子固定了大小，所以在大屏手机上盒子的间隙也会变大，这是我们不想看到的，传统方法解决，也是通过写多个媒体查询十分麻烦。</p>
<p>所以下面要引入rem动态方案。</p>
<h2 id="动态rem方案"><a href="#动态rem方案" class="headerlink" title="动态rem方案"></a>动态rem方案</h2><p>rem的意思是 root em，即根元素的font-size大小，也就是html的字体大小。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">html&#123;</span><br><span class="line">    font-size: 20px;</span><br><span class="line">&#125;</span><br><span class="line">div&#123;</span><br><span class="line">    width: 1rem  /*1rem === 20px*/</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>想让元素跟随屏幕大小改变，那么我们只需要动态的改变根元素大小，那么元素的大小就会跟随这改变。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">html&#123;</span><br><span class="line">    font-size: 20px;</span><br><span class="line">&#125;</span><br><span class="line">div&#123;</span><br><span class="line">    width: 1rem /*小于320px时为20px，320~375尺寸时为40px*/</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@media screen and (max-width: 375px) &#123;</span><br><span class="line">  html&#123;</span><br><span class="line">    font-size: 40px;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (max-width: 320px) &#123;</span><br><span class="line">  html&#123;</span><br><span class="line">    font-size: 20px;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里用媒体查询是为了直观的感受下用了rem单位后，元素大小可以随根字体大小的改变而改变。</p>
<h3 id="动态rem"><a href="#动态rem" class="headerlink" title="动态rem"></a>动态rem</h3><p>因为css无法获取屏幕宽度，所以我们需要用js来获取屏幕宽度来作换算。</p>
<p>一般来说设计稿会以750*1334的尺寸来做，对应手机真实宽度是375，此时根字体标准为20px（这个标准是自己设定的，只要不要太小就好，因为浏览器有最小字体大小限制的，这里我设置的是20px）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> html = <span class="built_in">document</span>.querySelector(<span class="string">'html'</span>)</span><br><span class="line"><span class="keyword">let</span> pageWidth = <span class="built_in">window</span>.innerWidth <span class="comment">//获取屏幕宽度</span></span><br><span class="line"><span class="keyword">let</span> size = <span class="number">20</span>*(pageWidth/<span class="number">375</span>) + <span class="string">'px'</span> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*通过实时的屏幕宽跟基准屏幕宽比较，然后就能得出实时的根字体大小;</span></span><br><span class="line"><span class="comment">*iphone6的尺寸（375）size = 20px</span></span><br><span class="line"><span class="comment">*iphone6 plus的尺寸（414）size = 22.08px （20*(414/375)）</span></span><br><span class="line"><span class="comment">*iphone5的尺寸（320）size = 17.0667px</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">html.style.fontSize = size  <span class="comment">//改变根字体大小</span></span><br></pre></td></tr></table></figure>

<p>相对应元素单位改成rem单位</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">div.parent&#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-around;</span><br><span class="line">&#125;</span><br><span class="line">div.child&#123;</span><br><span class="line">    width: 5rem;</span><br><span class="line">    height: 5rem;</span><br><span class="line">    background: red;</span><br><span class="line">    border: 1px solid black;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果图：</p>
<center>
<img src="http://wx4.sinaimg.cn/mw690/90cb06dbgy1fq8uz68fv1j20c205xjr8.jpg" alt="ip6 rem效果图" title="5.jpg">
</center>

<center>
<img src="http://wx4.sinaimg.cn/mw690/90cb06dbgy1fq8uz6k5lsj20c806uglg.jpg" alt="ip6 plus rem效果图" border="0">
</center>

<p>这样不管在什么移动设备上，都会等比例显示元素大小，能准确的还原设计稿。</p>
<p>但是有两个问题是：</p>
<p>1.页面字体也跟随缩放吗？</p>
<p>2.如果设计稿比较复杂，那么每一个元素宽高都得自己计算后才能写到css里，这样计算量不是会很多吗？</p>
<p>我先回答第一个问题，其实我个人不太建议页面字体也用rem来换算，因为如果要适配到平板等屏幕比较大的时候，那么这是字体会变得很大很粗糙，所以页面字体这一块我是单独适配的，用媒体查询。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">div&#123;</span><br><span class="line">    font-size: 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@media screen and (max-width: 321px) &#123;</span><br><span class="line">    body &#123;</span><br><span class="line">        font-size:20px</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@media screen and (min-width: 321px) and (max-width:400px) &#123;</span><br><span class="line">    body &#123;</span><br><span class="line">        font-size:22px</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@media screen and (min-width: 400px) &#123;</span><br><span class="line">    body &#123;</span><br><span class="line">        font-size:24px</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>给元素的font-size设置百分比，会找到最近的祖先元素的font-size，继承换算，最近的祖先元素就是body。</p>
<h3 id="sass减轻工作量"><a href="#sass减轻工作量" class="headerlink" title="sass减轻工作量"></a>sass减轻工作量</h3><p>回应第二个需要大量计算的问题，那就是利用sass的函数。</p>
<p>这里不说sass具体怎么安装怎么用，说下思路。</p>
<p>即100px要变成5rem（如果css是100px，那么设计稿的像素其实是200px）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">/*引入scss，以下为scss语法*/</span><br><span class="line">@function pxToRem( $px )&#123;</span><br><span class="line">    @return $px/($baseSize*2) + rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$baseSize = 20</span><br><span class="line"></span><br><span class="line">div.child&#123;</span><br><span class="line">    width: pxToRem(200); /*5rem*/</span><br><span class="line">    height: pxToRem(200);</span><br><span class="line">    background: red;</span><br><span class="line">    border: 1px solid black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>sass正常转译之后，那么就能得到对应的rem结果，可以直接拿到设计稿的像素来换算，这样就节省了大量的计算时间。</p>
<h2 id="移动端兼容"><a href="#移动端兼容" class="headerlink" title="移动端兼容"></a>移动端兼容</h2><p>兼容问题有时候会耗费我们大量的工作时间，即使是一个小小的问题也是不能忽视的。</p>
<p>兼容方面前辈们已经总结的很好了，这里我贴上他们的地址，基本能覆盖日常工作中遇到的问题。</p>
<p> <a href="http://blog.csdn.net/quanyuejie/article/details/53422081" target="_blank" rel="noopener">移动端webApp兼容问题解决</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/25149355?utm_medium=social&utm_source=wechat_session&from=message&isappinstalled=0" target="_blank" rel="noopener">H5项目常见问题汇总及解决方案</a></p>
<h2 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h2><p>我上面所讲的可能只覆盖了一部分的需求而已，在真实项目中会遇到更多的情况，我们只能不断的积累经验，用代码去节省我们的时间，把繁琐简单的工作交给程序去解决。</p>
<p>还有布局适配没有提到的百分比、vw，都可以去了解下，不是说一种模式定死了，工作中还得灵活运用，多种结合，找到最适合自己的一套方案。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/10/移动端适配/" data-id="cjx33319t000t1ld2fwnojae3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/适配/">适配</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS-AJAX/">JS AJAX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/">TypeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bug/">bug</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo-github/">hexo github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js-cookie/">js cookie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js-原型-类/">js 原型 类</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/心得/">心得</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/适配/">适配</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/JS-AJAX/" style="font-size: 10px;">JS AJAX</a> <a href="/tags/TypeScript/" style="font-size: 10px;">TypeScript</a> <a href="/tags/bug/" style="font-size: 10px;">bug</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/hexo-github/" style="font-size: 10px;">hexo github</a> <a href="/tags/js/" style="font-size: 20px;">js</a> <a href="/tags/js-cookie/" style="font-size: 10px;">js cookie</a> <a href="/tags/js-原型-类/" style="font-size: 10px;">js 原型 类</a> <a href="/tags/心得/" style="font-size: 10px;">心得</a> <a href="/tags/适配/" style="font-size: 10px;">适配</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/06/19/123/">123</a>
          </li>
        
          <li>
            <a href="/2019/06/19/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2019/06/19/TypeScript渐进(1)-安装及调试工具/">TypeScript渐进(1)-安装及调试工具</a>
          </li>
        
          <li>
            <a href="/2018/06/07/面试分享一/">面试分享一</a>
          </li>
        
          <li>
            <a href="/2018/05/22/注册登陆基本流程/">注册登陆基本流程</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 钟文钦<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>